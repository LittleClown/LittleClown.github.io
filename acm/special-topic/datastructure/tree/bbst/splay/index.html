<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>伸展树专题 | Clown's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="题目UVa&#x2F;11922 Permutation Transformer基础题。 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848">
<meta property="og:type" content="article">
<meta property="og:title" content="伸展树专题">
<meta property="og:url" content="http://littleclown.github.io/acm/special-topic/datastructure/tree/bbst/splay/index.html">
<meta property="og:site_name" content="Clown&#39;s Blog">
<meta property="og:description" content="题目UVa&#x2F;11922 Permutation Transformer基础题。 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-07-03T03:07:47.000Z">
<meta property="article:modified_time" content="2019-01-03T02:22:28.386Z">
<meta property="article:author" content="笑着哭的小丑">
<meta property="article:tag" content="ACM">
<meta property="article:tag" content="解题报告">
<meta property="article:tag" content="专题训练">
<meta property="article:tag" content="Splay">
<meta name="twitter:card" content="summary"><link rel="alternative" href="/atom.xml" title="Clown's Blog" type="application/atom+xml"><link rel="icon" href="/favicon.ico">
<link rel="stylesheet" href="/css/style.css">
<meta name="generator" content="Hexo 5.4.0"></head><body><div id="container"><div class="left-col"><div class="overlay"></div><div class="intrude-less"><header class="inner" id="header"><a class="profilepic" href="/"><img class="js-avatar" lazy-src="/img/avatar.jpg"/></a><hgroup><h1 class="header-author"><a href="/">笑着哭的小丑</a></h1></hgroup><p class="header-subtitle">博客已迁移至 https://me.guanghechen.com/posts/</p><div class="switch-btn"><div class="icon"><div class="icon-ctn"><div class="icon-wrap icon-house" data-idx="0"><div class="birdhouse"></div><div class="birdhouse_holes"></div></div><div class="icon-wrap icon-ribbon hide" data-idx="1"><div class="ribbon"></div></div><div class="icon-wrap icon-link hide" data-idx="2"><div class="loopback_l"></div><div class="loopback_r"></div></div><div class="icon-wrap icon-me hide" data-idx="3"><div class="user"></div><div class="shoulder"></div></div></div></div><div class="tips-box hide"><div class="tips-arrow"></div><ul class="tips-inner"><li>菜单</li><li>标签</li><li>友情链接</li><li>关于我</li></ul></div></div><div class="switch-area"><div class="switch-wrap"><section class="switch-part switch-part1"><nav class="header-menu"><ul><li><a href="/">主页</a></li><li><a href="/archives">文章</a></li></ul></nav><nav class="header-nav"><div class="social"><a class="github" target="_blank" href="https://github.com/LittleClown" title="github">github</a></div></nav></section><section class="switch-part switch-part2"><div class="widget tagcloud" id="js-tagcloud"><a href="/tags/ACM/" style="font-size: 20px;">ACM</a> <a href="/tags/Aho-Corasick-%E8%87%AA%E5%8A%A8%E6%9C%BA/" style="font-size: 10px;">Aho-Corasick 自动机</a> <a href="/tags/BFS/" style="font-size: 10px;">BFS</a> <a href="/tags/Baby-Step-Gaint-Step/" style="font-size: 11.67px;">Baby Step Gaint Step</a> <a href="/tags/Manacher/" style="font-size: 10px;">Manacher</a> <a href="/tags/SG-%E5%AE%9A%E7%90%86/" style="font-size: 10px;">SG 定理</a> <a href="/tags/Splay/" style="font-size: 10px;">Splay</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/keyword/" style="font-size: 10px;">keyword</a> <a href="/tags/protected/" style="font-size: 10px;">protected</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/web-%E5%BC%80%E5%8F%91/" style="font-size: 10px;">web 开发</a> <a href="/tags/%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83/" style="font-size: 11.67px;">专题训练</a> <a href="/tags/%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86/" style="font-size: 11.67px;">中国剩余定理</a> <a href="/tags/%E4%B8%AD%E7%BA%A7/" style="font-size: 11.67px;">中级</a> <a href="/tags/%E4%BA%8C%E5%88%86%E5%9B%BE/" style="font-size: 11.67px;">二分图</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 10px;">前端</a> <a href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" style="font-size: 13.33px;">动态规划</a> <a href="/tags/%E5%8E%9F%E6%A0%B9/" style="font-size: 11.67px;">原根</a> <a href="/tags/%E5%9B%BE%E8%AE%BA/" style="font-size: 11.67px;">图论</a> <a href="/tags/%E5%A4%8D%E6%95%B0/" style="font-size: 10px;">复数</a> <a href="/tags/%E5%AD%97%E5%85%B8%E6%A0%91/" style="font-size: 10px;">字典树</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 11.67px;">字符串</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 15px;">学习笔记</a> <a href="/tags/%E5%BF%AB%E9%80%9F%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/" style="font-size: 10px;">快速傅里叶变换</a> <a href="/tags/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97/" style="font-size: 11.67px;">扩展欧几里得</a> <a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 11.67px;">技术</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 13.33px;">数学</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 16.67px;">数据结构</a> <a href="/tags/%E6%95%B0%E8%AE%BA/" style="font-size: 16.67px;">数论</a> <a href="/tags/%E6%97%A2%E7%BA%A6%E5%89%A9%E4%BD%99%E7%B3%BB/" style="font-size: 10px;">既约剩余系</a> <a href="/tags/%E6%9C%80%E5%A4%A7%E6%9D%83%E9%97%AD%E5%90%88%E5%9B%BE/" style="font-size: 10px;">最大权闭合图</a> <a href="/tags/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/" style="font-size: 13.33px;">树链剖分</a> <a href="/tags/%E6%A6%82%E7%8E%87%E8%AE%BA/" style="font-size: 10px;">概率论</a> <a href="/tags/%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0/" style="font-size: 11.67px;">欧拉函数</a> <a href="/tags/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9/" style="font-size: 11.67px;">状态压缩</a> <a href="/tags/%E7%9F%A9%E9%98%B5/" style="font-size: 10px;">矩阵</a> <a href="/tags/%E7%9F%A9%E9%98%B5%E5%BF%AB%E9%80%9F%E5%B9%82%E5%8F%98%E5%BD%A2/" style="font-size: 10px;">矩阵快速幂变形</a> <a href="/tags/%E7%B4%A0%E6%95%B0%E7%BA%BF%E6%80%A7%E7%AD%9B/" style="font-size: 10px;">素数线性筛</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size: 11.67px;">线性代数</a> <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size: 13.33px;">线段树</a> <a href="/tags/%E7%BB%84%E5%90%88%E6%B8%B8%E6%88%8F/" style="font-size: 10px;">组合游戏</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size: 11.67px;">编译原理</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" style="font-size: 11.67px;">网络流</a> <a href="/tags/%E8%A1%8C%E5%88%97%E5%BC%8F/" style="font-size: 10px;">行列式</a> <a href="/tags/%E8%A7%A3%E9%A2%98%E6%8A%A5%E5%91%8A/" style="font-size: 18.33px;">解题报告</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" style="font-size: 11.67px;">计算机</a> <a href="/tags/%E8%AE%AD%E7%BB%83%E8%B5%9B/" style="font-size: 10px;">训练赛</a> <a href="/tags/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/" style="font-size: 10px;">语法分析</a> <a href="/tags/%E8%AF%AD%E6%B3%95%E5%88%B6%E5%AF%BC%E7%BF%BB%E8%AF%91/" style="font-size: 10px;">语法制导翻译</a> <a href="/tags/%E9%80%92%E6%8E%A8/" style="font-size: 10px;">递推</a> <a href="/tags/%E9%9A%BE%E9%A2%98/" style="font-size: 11.67px;">难题</a> <a href="/tags/%E9%AB%98%E7%BA%A7/" style="font-size: 10px;">高级</a></div></section><section class="switch-part switch-part3"><div id="js-friends"><a class="main-nav-link switch-friends-link" target="_blank" href="http://sparklingwind.github.io/">SparklingWind</a></div></section><section class="switch-part switch-part4"><div id="js-aboutme">时过境迁、惟愿此心不变、</div></section></div></div></header></div></div><div class="mid-col"><nav id="mobile-nav"><div class="overlay"><div class="slider-trigger"></div><h1 class="header-author js-mobile-header hide"></h1></div><div class="intrude-less"><header class="inner" id="header"><div class="profilepic"><img class="js-avatar"/></div><hgroup><h1 class="header-author"></h1></hgroup><nav class="header-menu"><ul><li><a href="/">主页</a></li><li><a href="/archives">文章</a></li><div class="clearfix"></div></ul></nav><nav class="header-nav"><div class="social"><a class="github" target="_blank" href="https://github.com/LittleClown" title="github">github</a></div></nav></header></div></nav><div class="body-wrap"><article class="article article-type-post" id="post-acm/special-topic/datastructure/tree/bbst/splay" itemscope="itemscope" itemprop="blogPost"><div class="article-meta"><a class="article-date" href="/acm/special-topic/datastructure/tree/bbst/splay/"><time datetime="2016-07-03T03:07:47.000Z" itemprop="datePublished">2016-07-03</time></a></div><div class="article-inner"><input class="isFancy" type="hidden"/><header class="article-header"><h1 class="article-title" itemprop="name">伸展树专题</h1></header><div class="article-info article-info-post"><div class="article-tag tagcloud"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ACM/" rel="tag">ACM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Splay/" rel="tag">Splay</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83/" rel="tag">专题训练</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A7%A3%E9%A2%98%E6%8A%A5%E5%91%8A/" rel="tag">解题报告</a></li></ul></div><div class="clearfix"></div></div><div class="article-entry" itemprop="articleBody"><!-- by SparklingWind--><div class="toc-article" id="toc"><div class="toc-title">目录<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B1%87%E6%80%BB"><span class="toc-number">2.</span> <span class="toc-text">汇总</span></a></li></ol></div></div><h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p><strong>UVa/11922 <em><a target="_blank" rel="noopener" href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=3073">Permutation Transformer</a></em></strong><br>基础题。<br><span id="UVa-11922"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">bool</span> flip;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line">    <span class="built_in">node</span>(<span class="keyword">int</span> key=<span class="number">0</span>): <span class="built_in">key</span>(key), <span class="built_in">siz</span>(<span class="number">0</span>), <span class="built_in">flip</span>(<span class="number">0</span>), <span class="built_in">lson</span>(<span class="literal">NULL</span>), <span class="built_in">rson</span>(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( key == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> key &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !flip ) <span class="keyword">return</span>;</span><br><span class="line">        lson-&gt;flip ^= <span class="number">1</span>;</span><br><span class="line">        rson-&gt;flip ^= <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">swap</span>(lson, rson);</span><br><span class="line">        flip = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123; siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;node*, node*&gt; droot;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line">node* null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line"></span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line">node* nodetop;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> node* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    nodetop-&gt;lson = null;</span><br><span class="line">    nodetop-&gt;rson = null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    node* k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    node* k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123; </span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(root&amp; o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    o = <span class="built_in">newnode</span>(mid);</span><br><span class="line">    <span class="keyword">if</span>( lft &lt; mid ) <span class="built_in">build</span>(o-&gt;lson, lft, mid<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span>( mid &lt; rht ) <span class="built_in">build</span>(o-&gt;rson, mid+<span class="number">1</span>, rht);</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == null ) <span class="keyword">return</span>;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">if</span>( o-&gt;lson != null ) <span class="built_in">print</span>(o-&gt;lson);</span><br><span class="line">    <span class="keyword">if</span>( o-&gt;key ) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, o-&gt;key);</span><br><span class="line">    <span class="keyword">if</span>( o-&gt;rson != null ) <span class="built_in">print</span>(o-&gt;rson);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root rt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> N)</span> </span>&#123;</span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">    <span class="built_in">build</span>(rt, <span class="number">0</span>, N);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> N, Q;</span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;N, &amp;Q) == <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="built_in">init</span>(N);</span><br><span class="line">        <span class="keyword">while</span>( Q-- ) &#123;</span><br><span class="line">            <span class="keyword">int</span> lft, rht;</span><br><span class="line">            root o, left, middle, right;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;lft, &amp;rht);</span><br><span class="line">            <span class="built_in">split</span>(rt, lft, left, o);</span><br><span class="line">            <span class="built_in">split</span>(o, rht-lft+<span class="number">1</span>, middle, right);</span><br><span class="line">            middle-&gt;flip ^= <span class="number">1</span>;</span><br><span class="line">            rt=<span class="built_in">merge</span>(<span class="built_in">merge</span>(left, right), middle);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>

<hr>
<p><strong>UVa/11996 <em><a target="_blank" rel="noopener" href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=3147">Jewel Magic</a></em></strong><br>用 hash 求 LCP，仅需用 splay 维护 hash 值即可。考虑到用反转操作，每个节点需要维护正反两个 hash 值。<br><span id="UVa-11996"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> ULL;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">400000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> hashkey = <span class="number">137</span>;</span><br><span class="line"></span><br><span class="line">ULL xp[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    ULL val;</span><br><span class="line">    ULL reval;</span><br><span class="line">    <span class="keyword">bool</span> flip;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> x &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flip ^= <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">swap</span>(lson, rson);</span><br><span class="line">        <span class="built_in">swap</span>(val, reval);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !flip ) <span class="keyword">return</span>;</span><br><span class="line">        lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        rson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        flip = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">        val = lson-&gt;val + key*xp[lson-&gt;siz] + rson-&gt;val*xp[lson-&gt;siz+<span class="number">1</span>];</span><br><span class="line">        reval = rson-&gt;reval + key*xp[rson-&gt;siz] + lson-&gt;reval*xp[rson-&gt;siz+<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;node*, node*&gt; droot;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">400000</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">node* null;</span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;val = <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;reval = <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    nodetop-&gt;lson = null;</span><br><span class="line">    nodetop-&gt;rson = null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; rt)</span> </span>&#123;</span><br><span class="line">    root k = rt-&gt;rson;</span><br><span class="line">    rt-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = rt;</span><br><span class="line">    rt = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; rt)</span> </span>&#123;</span><br><span class="line">    root k = rt-&gt;lson;</span><br><span class="line">    rt-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = rt;</span><br><span class="line">    rt = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; rt, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(rt): <span class="built_in">zag</span>(rt);</span><br><span class="line">    d? rt-&gt;rson-&gt;<span class="built_in">maintain</span>(): rt-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; rt, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    rt-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = rt-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= rt-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; pt = d? rt-&gt;rson: rt-&gt;lson;</span><br><span class="line">        pt-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = pt-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= pt-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? pt-&gt;rson: pt-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(rt, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(pt, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(rt, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root rt, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt, k);</span><br><span class="line">    left = rt;</span><br><span class="line">    right = rt-&gt;rson;</span><br><span class="line">    rt-&gt;rson = null;</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* insert at (k+1)th position. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(root&amp; rt, <span class="keyword">int</span> k, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    root left, right;</span><br><span class="line">    root middle = <span class="built_in">newnode</span>(key);</span><br><span class="line">    <span class="built_in">split</span>(rt, k, left, right);</span><br><span class="line">    rt = <span class="built_in">merge</span>(<span class="built_in">merge</span>(left, middle), right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* remove at (k+1)th position. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(root&amp; rt, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    root left, middle, right;</span><br><span class="line">    <span class="built_in">split</span>(rt, k, left, right);</span><br><span class="line">    <span class="built_in">split</span>(right, <span class="number">1</span>, middle, right);</span><br><span class="line">    rt = <span class="built_in">merge</span>(left, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* modify [lft+1, rht+1]. */</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(root&amp; rt, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt, lft);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, rht-lft+<span class="number">2</span>);</span><br><span class="line">    rt-&gt;rson-&gt;lson-&gt;<span class="built_in">reverse</span>(); <span class="comment">/* update rt-&gt;rson-&gt;lson, rt-&gt;rson, rt */</span></span><br><span class="line">    rt-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(root&amp; rt, <span class="keyword">int</span> p1, <span class="keyword">int</span> p2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> lft = <span class="number">0</span>, rht = rt-&gt;siz - p2;</span><br><span class="line">    <span class="keyword">while</span>( lft &lt; rht ) &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">splay</span>(rt, p1);</span><br><span class="line">        <span class="built_in">splay</span>(rt-&gt;rson, mid+<span class="number">1</span>);</span><br><span class="line">        ULL val1 = rt-&gt;rson-&gt;lson-&gt;val;</span><br><span class="line">        <span class="built_in">splay</span>(rt, p2);</span><br><span class="line">        <span class="built_in">splay</span>(rt-&gt;rson, mid+<span class="number">1</span>);</span><br><span class="line">        ULL val2 = rt-&gt;rson-&gt;lson-&gt;val;</span><br><span class="line">        <span class="keyword">if</span>( val1 == val2 ) lft = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> rht = mid;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lft<span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root rt;</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line"><span class="keyword">int</span> N, Q, op, arg1, arg2;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(root&amp; rt, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    rt = <span class="built_in">newnode</span>(s[mid]-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>( lft &lt; mid ) <span class="built_in">build</span>(rt-&gt;lson, lft, mid<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span>( mid &lt; rht ) <span class="built_in">build</span>(rt-&gt;rson, mid+<span class="number">1</span>, rht);</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, s+<span class="number">1</span>);</span><br><span class="line">    s[<span class="number">0</span>] = s[N+<span class="number">1</span>] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="built_in">build</span>(rt, <span class="number">0</span>, N+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>());</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">    <span class="built_in">memset</span>(null, <span class="number">0</span>, <span class="built_in"><span class="keyword">sizeof</span></span>(node));</span><br><span class="line">    xp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt; MAXN; ++i)</span><br><span class="line">        xp[i] = xp[i<span class="number">-1</span>] * hashkey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;N, &amp;Q) == <span class="number">2</span> ) &#123;</span><br><span class="line">        <span class="built_in">Init</span>();</span><br><span class="line">        <span class="keyword">while</span>( Q-- ) &#123;</span><br><span class="line">            op = <span class="built_in">read</span>();</span><br><span class="line">            arg1 = <span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>( op != <span class="number">2</span> ) arg2 = <span class="built_in">read</span>();</span><br><span class="line">            <span class="built_in"><span class="keyword">switch</span></span>( op ) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>: <span class="built_in">insert</span>(rt, arg1+<span class="number">1</span>, arg2); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>: <span class="built_in">remove</span>(rt, arg1); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>: <span class="built_in">update</span>(rt, arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">query</span>(rt, arg1, arg2)); <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<span id="more"></span>

<hr>
<p><strong>hihoCoder/1329 <em><a target="_blank" rel="noopener" href="http://hihocoder.com/problemset/problem/1329">平衡树 Splay</a></em></strong><br>基础题。<br><span id="hihoCoder-1329"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> x &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"><span class="keyword">typedef</span> std:: pair&lt;node*, node*&gt; droot;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">200000</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">node* null;</span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;lson = null;</span><br><span class="line">    nodetop-&gt;rson = null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rank</span><span class="params">(root o, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == null ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( key == o-&gt;key ) <span class="keyword">return</span> o-&gt;lson-&gt;siz;</span><br><span class="line">    <span class="keyword">if</span>( key &lt; o-&gt;key ) <span class="keyword">return</span> <span class="built_in">rank</span>(o-&gt;lson, key);</span><br><span class="line">    <span class="keyword">return</span> o-&gt;lson-&gt;siz+<span class="number">1</span> + <span class="built_in">rank</span>(o-&gt;rson, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(root&amp; o, <span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="built_in">rank</span>(o, id);</span><br><span class="line">    root left, right;</span><br><span class="line">    root middle = <span class="built_in">newnode</span>(id);</span><br><span class="line">    <span class="built_in">split</span>(o, k, left, right);</span><br><span class="line">    o = <span class="built_in">merge</span>(<span class="built_in">merge</span>(left, middle), right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(root&amp; o, <span class="keyword">int</span> id1, <span class="keyword">int</span> id2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k1 = <span class="built_in">rank</span>(o, id1);</span><br><span class="line">    <span class="keyword">int</span> k2 = <span class="built_in">rank</span>(o, id2+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>( k1 &gt;= k2 ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    root left, middle, right;</span><br><span class="line">    <span class="built_in">split</span>(o, k1, left, right);</span><br><span class="line">    <span class="built_in">split</span>(right, k2-k1, middle, right);</span><br><span class="line">    o = <span class="built_in">merge</span>(left, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(root&amp; o, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == null ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( key &lt; o-&gt;key ) <span class="keyword">return</span> <span class="built_in">query</span>(o-&gt;lson, key);</span><br><span class="line">    <span class="keyword">return</span> std:: <span class="built_in">max</span>(o-&gt;key, <span class="built_in">query</span>(o-&gt;rson, key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root rt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">    null-&gt;key = <span class="number">0</span>;</span><br><span class="line">    null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">    rt = <span class="built_in">newnode</span>(<span class="number">0</span>);</span><br><span class="line">    rt-&gt;rson = <span class="built_in">newnode</span>(<span class="number">1000000001</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, arg1, arg2, arg3;</span><br><span class="line"><span class="keyword">char</span> cmd[<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    N = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">        arg1 = std:: <span class="built_in">min</span>(std:: <span class="built_in">max</span>(<span class="built_in">read</span>(), <span class="number">1</span>), <span class="number">1000000000</span>);</span><br><span class="line">        <span class="keyword">if</span>( cmd[<span class="number">0</span>] == <span class="string">&#x27;D&#x27;</span> ) arg2 = std:: <span class="built_in">min</span>(std:: <span class="built_in">max</span>(<span class="built_in">read</span>(), <span class="number">1</span>), <span class="number">1000000000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span>( cmd[<span class="number">0</span>] ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>: <span class="built_in">insert</span>(rt, arg1); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Q&#x27;</span>: <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(rt, arg1)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: <span class="built_in">remove</span>(rt, arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>

<hr>
<p><strong>hihoCoder/1333 <em><a target="_blank" rel="noopener" href="http://hihocoder.com/problemset/problem/1333">平衡树 Splay2</a></em></strong><br>节点中维护 add，sum，key，siz，val。其中，key 为每个人的 id，val 为每个人的兴趣值。在进行区间操作时，利用 key，计算出左右区间在 splay 中的名次，然后使用该名次 + 基础 splay 操作就可以了。<br><span id="hihoCoder-1333"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    <span class="keyword">int</span> add;</span><br><span class="line">    LL sum;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> x &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !add ) <span class="keyword">return</span>;</span><br><span class="line">        lson-&gt;<span class="built_in">update</span>(add);</span><br><span class="line">        rson-&gt;<span class="built_in">update</span>(add);</span><br><span class="line">        add = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> add)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( <span class="keyword">this</span>-&gt;lson == <span class="literal">NULL</span> ) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;add += add;</span><br><span class="line">        <span class="keyword">this</span>-&gt;val += add;</span><br><span class="line">        <span class="keyword">this</span>-&gt;sum += (LL) add * <span class="keyword">this</span>-&gt;siz;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">        sum = lson-&gt;sum + val + rson-&gt;sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"><span class="keyword">typedef</span> std:: pair&lt;node*, node*&gt; droot;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">200000</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">node* null;</span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>, <span class="keyword">int</span> val=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;val = val;</span><br><span class="line">    nodetop-&gt;add = <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;sum = val;</span><br><span class="line">    nodetop-&gt;lson = null;</span><br><span class="line">    nodetop-&gt;rson = null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rank</span><span class="params">(root o, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == null ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>( key == o-&gt;key ) <span class="keyword">return</span> o-&gt;lson-&gt;siz;</span><br><span class="line">    <span class="keyword">if</span>( key &lt; o-&gt;key ) <span class="keyword">return</span> <span class="built_in">rank</span>(o-&gt;lson, key);</span><br><span class="line">    <span class="keyword">return</span> o-&gt;lson-&gt;siz+<span class="number">1</span> + <span class="built_in">rank</span>(o-&gt;rson, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(root&amp; o, <span class="keyword">int</span> id, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="built_in">rank</span>(o, id);</span><br><span class="line">    root left, right;</span><br><span class="line">    root middle = <span class="built_in">newnode</span>(id, val);</span><br><span class="line">    <span class="built_in">split</span>(o, k, left, right);</span><br><span class="line">    o = <span class="built_in">merge</span>(<span class="built_in">merge</span>(left, middle), right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(root&amp; o, <span class="keyword">int</span> id1, <span class="keyword">int</span> id2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k1 = <span class="built_in">rank</span>(o, id1);</span><br><span class="line">    <span class="keyword">int</span> k2 = <span class="built_in">rank</span>(o, id2+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>( k1 &gt;= k2 ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    root left, middle, right;</span><br><span class="line">    <span class="built_in">split</span>(o, k1, left, right);</span><br><span class="line">    <span class="built_in">split</span>(right, k2-k1, middle, right);</span><br><span class="line">    o = <span class="built_in">merge</span>(left, right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(root&amp; o, <span class="keyword">int</span> id1, <span class="keyword">int</span> id2, <span class="keyword">int</span> add)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k1 = <span class="built_in">rank</span>(o, id1);</span><br><span class="line">    <span class="keyword">int</span> k2 = <span class="built_in">rank</span>(o, id2+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>( k1 &gt;= k2 ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">splay</span>(o, k1);</span><br><span class="line">    <span class="built_in">splay</span>(o-&gt;rson, k2-k1+<span class="number">1</span>);</span><br><span class="line">    o-&gt;rson-&gt;lson-&gt;<span class="built_in">update</span>(add);</span><br><span class="line">    o-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">query</span><span class="params">(root&amp; o, <span class="keyword">int</span> id1, <span class="keyword">int</span> id2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k1 = <span class="built_in">rank</span>(o, id1);</span><br><span class="line">    <span class="keyword">int</span> k2 = <span class="built_in">rank</span>(o, id2+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>( k1 &gt;= k2 ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">splay</span>(o, k1);</span><br><span class="line">    <span class="built_in">splay</span>(o-&gt;rson, k2-k1+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> o-&gt;rson-&gt;lson-&gt;sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root rt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">    null-&gt;key = <span class="number">0</span>;</span><br><span class="line">    null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    null-&gt;val = <span class="number">0</span>;</span><br><span class="line">    null-&gt;add = <span class="number">0</span>;</span><br><span class="line">    null-&gt;sum = <span class="number">0</span>;</span><br><span class="line">    null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">    rt = <span class="built_in">newnode</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    rt-&gt;rson = <span class="built_in">newnode</span>(<span class="number">1000000001</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, arg1, arg2, arg3;</span><br><span class="line"><span class="keyword">char</span> cmd[<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line">    N = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">        arg1 = std:: <span class="built_in">min</span>(std:: <span class="built_in">max</span>(<span class="built_in">read</span>(), <span class="number">1</span>), <span class="number">100000000</span>);</span><br><span class="line">        arg2 = std:: <span class="built_in">min</span>(std:: <span class="built_in">max</span>(<span class="built_in">read</span>(), <span class="number">1</span>), <span class="number">100000000</span>);</span><br><span class="line">        <span class="keyword">if</span>( cmd[<span class="number">0</span>] == <span class="string">&#x27;M&#x27;</span> ) arg3 = <span class="built_in">read</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span>( cmd[<span class="number">0</span>] ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>: <span class="built_in">insert</span>(rt, arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;Q&#x27;</span>: <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, <span class="built_in">query</span>(rt, arg1, arg2)); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>: <span class="built_in">update</span>(rt, arg1, arg2, arg3); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: <span class="built_in">remove</span>(rt, arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>

<hr>
<p><strong>LA/3961 <em><a target="_blank" rel="noopener" href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=1962">Robotic Sort</a></em></strong><br>初始时，建一棵 1～$N$ 的 splay，并对原序列进行排序（排序规则为：值小的优先，值相等时，在原序列靠左的优先）。对于第 $k$ 次询问，将值为 $k$ 的节点伸展至根，然后就是些基础的操作了。问题的难点在于快速找到值为 $k$ 的节点。<br>法一：用一个父指针，直接从值为 $k$ 的节点往上伸展就好了。之所以扯这么多，是因为此前一直都是用 刘汝佳 的递归写法（被惯坏了），不需要父指针。<br><span id="LA-3961_1"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">bool</span> flip;</span><br><span class="line">    node* prev;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flip ^= <span class="number">1</span>;</span><br><span class="line">        std:: <span class="built_in">swap</span>(lson, rson);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !flip ) <span class="keyword">return</span>;</span><br><span class="line">        lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        rson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        flip = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson-&gt;prev = o;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o-&gt;prev = k;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson-&gt;prev = o;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o-&gt;prev = k;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 带父指针的 旋转 和 伸展操作 是此问题最大的难点（蒽，被刘汝佳的代码惯坏了。。</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d2 = <span class="number">-1</span>;</span><br><span class="line">    root p = o-&gt;prev;</span><br><span class="line">    <span class="keyword">if</span>( p != <span class="literal">NULL</span> ) d2 = p-&gt;lson == o? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) d2? p-&gt;rson = o: p-&gt;lson = o;</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>(); </span><br><span class="line">    o-&gt;prev = p;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意，d 必须在 pushdown 之后计算，因为有交换子树的操作。</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root o, root f)</span> </span>&#123;</span><br><span class="line"><span class="comment">// o 必须先 pushdown() 一次，因为可能 o 已经是 f 的子节点，</span></span><br><span class="line"><span class="comment">// 但为了保持 “splay 操作后的根节点标记全部下传” 的传统，需要这么做。</span></span><br><span class="line">    <span class="keyword">for</span>(o-&gt;<span class="built_in">pushdown</span>(); o-&gt;prev != f;) &#123;</span><br><span class="line">        root p = o-&gt;prev;</span><br><span class="line">        <span class="keyword">if</span>( p-&gt;prev == f ) &#123;</span><br><span class="line">            p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">            o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">            <span class="keyword">int</span> d = p-&gt;lson == o? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">            <span class="built_in">rotate</span>(p, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        root g = p-&gt;prev;</span><br><span class="line">        g-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d = p-&gt;lson == o? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> d2 = g-&gt;lson == p? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(g, d2^<span class="number">1</span>), <span class="built_in">rotate</span>(p, d^<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d^<span class="number">1</span>), <span class="built_in">rotate</span>(g, d2^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line">node* null;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(root&amp; o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    o = nodepool + mid;</span><br><span class="line">    o-&gt;key = mid;</span><br><span class="line">    o-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    o-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>( lft &lt; mid ) <span class="built_in">build</span>(o-&gt;lson, lft, mid<span class="number">-1</span>); <span class="keyword">else</span> o-&gt;lson = null;</span><br><span class="line">    <span class="keyword">if</span>( mid &lt; rht ) <span class="built_in">build</span>(o-&gt;rson, mid+<span class="number">1</span>, rht); <span class="keyword">else</span> o-&gt;rson = null;</span><br><span class="line">    o-&gt;lson-&gt;prev = o;</span><br><span class="line">    o-&gt;rson-&gt;prev = o;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">solve</span><span class="params">(root&amp; rt, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    root o = nodepool+key;</span><br><span class="line">    <span class="built_in">splay</span>(o, rt-&gt;prev);</span><br><span class="line">    <span class="keyword">int</span> ans = o-&gt;lson-&gt;siz;</span><br><span class="line">    <span class="keyword">if</span>( ans ) &#123;</span><br><span class="line">        root k = o-&gt;lson;</span><br><span class="line">        k-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        <span class="keyword">for</span>(; k-&gt;rson != null; k=k-&gt;rson) k-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="built_in">splay</span>(k, o);</span><br><span class="line">        k-&gt;rson = o-&gt;rson;</span><br><span class="line">        o-&gt;rson-&gt;prev = k;</span><br><span class="line">        o = k;</span><br><span class="line">    &#125; <span class="keyword">else</span> o = o-&gt;rson;</span><br><span class="line">    rt = o;</span><br><span class="line">    rt-&gt;prev = <span class="literal">NULL</span>;</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> std:: pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; pii;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">root rt;</span><br><span class="line">pii A[MAXN];</span><br><span class="line"><span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i)</span><br><span class="line">        A[i] = <span class="built_in">pii</span>(<span class="built_in">read</span>(), i);</span><br><span class="line">    <span class="built_in">sort</span>(A+<span class="number">1</span>, A+N+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">build</span>(rt, <span class="number">1</span>, N);</span><br><span class="line">    rt-&gt;prev = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">    null-&gt;key = <span class="number">0</span>;</span><br><span class="line">    null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    null-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N) == <span class="number">1</span> &amp;&amp; N ) &#123;</span><br><span class="line">        <span class="built_in">Init</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt; N; ++i) </span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, <span class="built_in">solve</span>(rt, A[i].second)+i);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, N);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<strong> update time: 2016/07/05 </strong>
法二：将原序列离散化成 1～$N$，建成 splay，多维护一个区间最小值，利用维护的 siz，就可以实现名次树的一些功能，就可以快速查找了。
<span id="LA-3961_2">
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">int</span> minv;</span><br><span class="line">    <span class="keyword">bool</span> flip;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( key == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> key &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flip ^= <span class="number">1</span>;</span><br><span class="line">        std:: <span class="built_in">swap</span>(lson, rson);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !flip ) <span class="keyword">return</span>;</span><br><span class="line">        lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        rson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        flip = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">        minv = std:: <span class="built_in">min</span>(key, std:: <span class="built_in">min</span>(lson-&gt;minv, rson-&gt;minv));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line">node* null;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d2^<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">kth</span><span class="params">(root rt)</span> </span>&#123;</span><br><span class="line">    rt-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">if</span>( rt-&gt;key == rt-&gt;minv ) <span class="keyword">return</span> rt-&gt;lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( rt-&gt;lson-&gt;minv &lt; rt-&gt;rson-&gt;minv ) <span class="keyword">return</span> <span class="built_in">kth</span>(rt-&gt;lson);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">kth</span>(rt-&gt;rson) + rt-&gt;lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;minv = key;</span><br><span class="line">    nodetop-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    nodetop-&gt;lson = null;</span><br><span class="line">    nodetop-&gt;rson = null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(root&amp; o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht, <span class="keyword">int</span>* rank)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    o = <span class="built_in">newnode</span>(rank[mid]);</span><br><span class="line">    <span class="keyword">if</span>( lft &lt; mid ) <span class="built_in">build</span>(o-&gt;lson, lft, mid<span class="number">-1</span>, rank);</span><br><span class="line">    <span class="keyword">if</span>( mid &lt; rht ) <span class="built_in">build</span>(o-&gt;rson, mid+<span class="number">1</span>, rht, rank);</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="keyword">int</span> N, A[MAXN], id[MAXN], rank[MAXN];</span><br><span class="line">root rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123; <span class="keyword">return</span> A[u] &lt; A[v]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="built_in">kth</span>(rt);</span><br><span class="line">    <span class="built_in">splay</span>(rt, k);</span><br><span class="line">    <span class="keyword">int</span> ans = rt-&gt;lson-&gt;siz;</span><br><span class="line">    <span class="keyword">if</span>( ans ) &#123;</span><br><span class="line">        rt-&gt;lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        <span class="built_in">splay</span>(rt-&gt;lson, rt-&gt;lson-&gt;siz);</span><br><span class="line">        rt = <span class="built_in">merge</span>(rt-&gt;lson, rt-&gt;rson);</span><br><span class="line">    &#125; <span class="keyword">else</span> rt = rt-&gt;rson, rt-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;    </span><br><span class="line">    null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">    null-&gt;key = <span class="number">0</span>;</span><br><span class="line">    null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    null-&gt;minv = INF;</span><br><span class="line">    null-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N) == <span class="number">1</span> &amp;&amp; N ) &#123;</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) A[i] = <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) id[i] = i;</span><br><span class="line">        std:: <span class="built_in">stable_sort</span>(id+<span class="number">1</span>, id+N+<span class="number">1</span>, cmp);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) rank[id[i]] = i;</span><br><span class="line">        <span class="built_in">build</span>(rt, <span class="number">1</span>, N, rank);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt; N; ++i) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, <span class="built_in">solve</span>()+i); </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, N);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<strong> update time: 2016/07/06 </strong>

<hr>
<p><strong>HYSBZ/1269 <em><a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1269">文本编辑器 editor</a></em></strong><br>都是一些 splay 的经典操作，为了方便操作，在最最左边和最右边分别加了一个虚拟节点。<br><span id="HYSBZ-1269"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">char</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">bool</span> flip;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> x &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flip ^= <span class="number">1</span>;</span><br><span class="line">        std:: <span class="built_in">swap</span>(lson, rson);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !flip ) <span class="keyword">return</span>;</span><br><span class="line">        lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        rson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">        flip ^= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = (<span class="number">1</span>&lt;&lt;<span class="number">22</span>) + <span class="number">10</span>;</span><br><span class="line">node* null;</span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">char</span> key)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    nodetop-&gt;lson = null;</span><br><span class="line">    nodetop-&gt;rson = null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(root&amp; o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht, <span class="keyword">char</span>* s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    o = <span class="built_in">newnode</span>(s[mid]);</span><br><span class="line">    <span class="keyword">if</span>( lft &lt; mid ) <span class="built_in">build</span>(o-&gt;lson, lft, mid<span class="number">-1</span>, s);</span><br><span class="line">    <span class="keyword">if</span>( mid &lt; rht ) <span class="built_in">build</span>(o-&gt;rson, mid+<span class="number">1</span>, rht, s);</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = (<span class="number">1</span>&lt;&lt;<span class="number">22</span>) + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">char</span> s[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Move</span><span class="params">(root&amp; rt, <span class="keyword">int</span> k)</span> </span>&#123; <span class="built_in">splay</span>(rt, k); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Insert</span><span class="params">(root&amp; rt, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(s[<span class="number">1</span>]=<span class="built_in">getchar</span>(); s[<span class="number">1</span>] &lt; <span class="number">32</span> || s[<span class="number">1</span>] &gt; <span class="number">126</span>;) s[<span class="number">1</span>] = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>; i &lt;= n; ++i) s[i] = <span class="built_in">getchar</span>();</span><br><span class="line">    root left = rt;</span><br><span class="line">    root middle; <span class="built_in">build</span>(middle, <span class="number">1</span>, n, s);</span><br><span class="line">    root right = rt-&gt;rson;</span><br><span class="line">    rt-&gt;rson = null;</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt = <span class="built_in">merge</span>(left, <span class="built_in">merge</span>(middle, right));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Delete</span><span class="params">(root&amp; rt, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, n);</span><br><span class="line">    rt-&gt;rson = rt-&gt;rson-&gt;rson;</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Rotate</span><span class="params">(root&amp; rt, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, n+<span class="number">1</span>);</span><br><span class="line">    rt-&gt;rson-&gt;lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Get</span><span class="params">(root&amp; rt)</span> </span>&#123;</span><br><span class="line">    root o = rt-&gt;rson;</span><br><span class="line">    <span class="keyword">for</span>(; o-&gt;lson != null; o=o-&gt;lson) o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>, o-&gt;key);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Prev</span><span class="params">(root&amp; rt)</span> </span>&#123; <span class="built_in">splay</span>(rt, rt-&gt;lson-&gt;siz); &#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Next</span><span class="params">(root&amp; rt)</span> </span>&#123; <span class="built_in">splay</span>(rt, rt-&gt;lson-&gt;siz+<span class="number">2</span>); &#125;</span><br><span class="line"></span><br><span class="line">root rt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">    null-&gt;key = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    null-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">    rt = <span class="built_in">newnode</span>(<span class="number">31</span>);</span><br><span class="line">    rt-&gt;rson = <span class="built_in">newnode</span>(<span class="number">127</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> cmd[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> N = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span>( cmd[<span class="number">0</span>] ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>: <span class="built_in">Move</span>(rt, <span class="built_in">read</span>()+<span class="number">1</span>); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>: <span class="built_in">Insert</span>(rt, <span class="built_in">read</span>()); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: <span class="built_in">Delete</span>(rt, <span class="built_in">read</span>()); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>: <span class="built_in">Rotate</span>(rt, <span class="built_in">read</span>()); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;G&#x27;</span>: <span class="built_in">Get</span>(rt); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;P&#x27;</span>: <span class="built_in">Prev</span>(rt); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;N&#x27;</span>: <span class="built_in">Next</span>(rt); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<strong> update time: 2016/07/05 </strong>

<hr>
<p><strong>HYSBZ/1500 <em><a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1500">维修数列</a></em></strong><br>前五个操作比较简单，第六个操作，需要维护：子树左侧起最大连续和 $mxlv$（可以为空），子树右侧起最大连续和 $mxrv$（可以为空），子树中最大连续和 $mxmv$（非空）。在序列的最左侧和最右侧增加两个虚拟节点就可以很方便了，注意为了不影响结果的正确性，虚拟节点的 sum 值需为 0，但是节点的 $key,mxlv,mxmv,mxrv$ 均需设成负无穷。<br><span id="HYSBZ-1500"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">int</span> setv;   <span class="comment">// 懒惰标记，表示是否标记为同一个值</span></span><br><span class="line">    <span class="keyword">int</span> sumv;   <span class="comment">// 该节点为根的子树的 $\sum key$</span></span><br><span class="line">    <span class="keyword">int</span> mxlv;   <span class="comment">// 该节点为根的子树表示的序列左侧（可以为空）最大连续和</span></span><br><span class="line">    <span class="keyword">int</span> mxmv;   <span class="comment">// 该节点为根的子树最大连续和</span></span><br><span class="line">    <span class="keyword">int</span> mxrv;   <span class="comment">// 该节点为根的子树表示的序列右侧（可以为空）最大连续和</span></span><br><span class="line">    <span class="keyword">bool</span> flip;  <span class="comment">// 懒惰标记，表示是否翻转</span></span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> node* null;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> x &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        flip ^= <span class="number">1</span>;</span><br><span class="line">        std:: <span class="built_in">swap</span>(lson, rson);</span><br><span class="line">        std:: <span class="built_in">swap</span>(mxlv, mxrv);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">        setv = tag;</span><br><span class="line">        key = tag;</span><br><span class="line">        sumv = tag * siz;</span><br><span class="line">        mxlv = mxrv = tag &gt; <span class="number">0</span>? sumv: <span class="number">0</span>;</span><br><span class="line">        mxmv = tag &gt; <span class="number">0</span>? sumv: tag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( flip ) &#123;</span><br><span class="line">            lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">            rson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">            flip = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>( setv != -INF ) &#123;</span><br><span class="line">            <span class="keyword">if</span>( lson != null ) lson-&gt;<span class="built_in">update</span>(setv);</span><br><span class="line">            <span class="keyword">if</span>( rson != null ) rson-&gt;<span class="built_in">update</span>(setv);</span><br><span class="line">            setv = -INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">        sumv = lson-&gt;sumv + key + rson-&gt;sumv;</span><br><span class="line">        mxlv = std:: <span class="built_in">max</span>(lson-&gt;mxlv, lson-&gt;sumv + key + rson-&gt;mxlv);</span><br><span class="line">        mxrv = std:: <span class="built_in">max</span>(rson-&gt;mxrv, lson-&gt;mxrv + key + rson-&gt;sumv);</span><br><span class="line">        mxmv = std:: <span class="built_in">max</span>(lson-&gt;mxmv, rson-&gt;mxmv);</span><br><span class="line">        mxmv = std:: <span class="built_in">max</span>(mxmv, lson-&gt;mxrv + key + rson-&gt;mxlv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line">node* node:: null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = node:: null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">merge</span><span class="params">(root left, root right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(left, left-&gt;siz);</span><br><span class="line">    left-&gt;rson = right;</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/********************** 以上为 splay 基本操作 *******************/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">1000000</span>+<span class="number">10</span>;</span><br><span class="line">std:: queue&lt;root&gt; Qnodepool;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    root nodetop = Qnodepool.<span class="built_in">front</span>(); Qnodepool.<span class="built_in">pop</span>();</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;setv = -INF;</span><br><span class="line">    nodetop-&gt;sumv = key;</span><br><span class="line">    nodetop-&gt;mxlv = key &gt; <span class="number">0</span>? key: <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;mxmv = key;</span><br><span class="line">    nodetop-&gt;mxrv = key &gt; <span class="number">0</span>? key: <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    nodetop-&gt;lson = node:: null;</span><br><span class="line">    nodetop-&gt;rson = node:: null;</span><br><span class="line">    <span class="keyword">return</span> nodetop;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">deletenode</span><span class="params">(root o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == node:: null ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">deletenode</span>(o-&gt;lson);</span><br><span class="line">    <span class="built_in">deletenode</span>(o-&gt;rson);</span><br><span class="line">    Qnodepool.<span class="built_in">push</span>(o);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(root&amp; o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht, <span class="keyword">int</span>* A)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (lft+rht) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    o = <span class="built_in">newnode</span>(A[mid]);</span><br><span class="line">    <span class="keyword">if</span>( lft &lt; mid ) <span class="built_in">build</span>(o-&gt;lson, lft, mid<span class="number">-1</span>, A);</span><br><span class="line">    <span class="keyword">if</span>( mid &lt; rht ) <span class="built_in">build</span>(o-&gt;rson, mid+<span class="number">1</span>, rht, A);</span><br><span class="line">    <span class="keyword">if</span>( A[mid] == -INF ) o-&gt;sumv = <span class="number">0</span>;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">500000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> A[MAXN];</span><br><span class="line">root rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">INSERT</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tot)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= tot; ++i) A[i] = <span class="built_in">read</span>();</span><br><span class="line">    root left, middle, right;</span><br><span class="line">    <span class="built_in">build</span>(middle, <span class="number">1</span>, tot, A);</span><br><span class="line">    <span class="built_in">split</span>(rt, pos+<span class="number">1</span>, left, right);</span><br><span class="line">    rt = <span class="built_in">merge</span>(<span class="built_in">merge</span>(left, middle), right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">DELETE</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tot)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt, pos);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, tot+<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">deletenode</span>(rt-&gt;rson-&gt;lson);</span><br><span class="line"></span><br><span class="line">    rt-&gt;rson-&gt;lson = node:: null;</span><br><span class="line">    rt-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MODIFY</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tot, <span class="keyword">int</span> tag)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt, pos);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, tot+<span class="number">1</span>);</span><br><span class="line">    rt-&gt;rson-&gt;lson-&gt;<span class="built_in">update</span>(tag);</span><br><span class="line">    rt-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">REVERSE</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tot)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt, pos);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, tot+<span class="number">1</span>);</span><br><span class="line">    rt-&gt;rson-&gt;lson-&gt;<span class="built_in">reverse</span>();</span><br><span class="line">    rt-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">GETSUM</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> tot)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(rt, pos);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, tot+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> rt-&gt;rson-&gt;lson-&gt;sumv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">MAXSUM</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> rt-&gt;mxmv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>( !Qnodepool.<span class="built_in">empty</span>() ) Qnodepool.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; MAX_NODES; ++i) Qnodepool.<span class="built_in">push</span>(nodepool+i);</span><br><span class="line">    node:: null-&gt;key = -INF;</span><br><span class="line">    node:: null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;setv = -INF;</span><br><span class="line">    node:: null-&gt;sumv = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;mxlv = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;mxmv = -INF;</span><br><span class="line">    node:: null-&gt;mxrv = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;flip = <span class="literal">false</span>;</span><br><span class="line">    node:: null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    node:: null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> N = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">int</span> Q = <span class="built_in">read</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) A[i] = <span class="built_in">read</span>();</span><br><span class="line">    A[<span class="number">0</span>] = A[N+<span class="number">1</span>] = -INF;</span><br><span class="line">    <span class="built_in">build</span>(rt, <span class="number">0</span>, N+<span class="number">1</span>, A);</span><br><span class="line">    <span class="keyword">while</span>( Q-- ) &#123;</span><br><span class="line">        <span class="keyword">char</span> cmd[<span class="number">20</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">        <span class="keyword">if</span>( cmd[<span class="number">0</span>] == <span class="string">&#x27;M&#x27;</span> &amp;&amp; cmd[<span class="number">2</span>] == <span class="string">&#x27;X&#x27;</span> ) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">MAXSUM</span>());</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> arg1 = <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">int</span> arg2 = <span class="built_in">read</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span>( cmd[<span class="number">0</span>] ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>: <span class="built_in">INSERT</span>(arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: <span class="built_in">DELETE</span>(arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;M&#x27;</span>: <span class="built_in">MODIFY</span>(arg1, arg2, <span class="built_in">read</span>()); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;R&#x27;</span>: <span class="built_in">REVERSE</span>(arg1, arg2); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;G&#x27;</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">GETSUM</span>(arg1, arg2)); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<strong> update time: 2016/07/07 </strong>

<hr>
<p><strong>POJ/2828 <em><a target="_blank" rel="noopener" href="http://poj.org/problem?id=2828">Buy Tickets</a></em></strong><br>法一：在线做。直接 splay 模拟，容易超时，可以检验自己 splay 写法常数大不大（不加读入读出优化的前提下）。<br>Hint POJ 加读入读出优化能快很多 = =<br><span id="POJ-2828_1"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> node* null;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( x == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> x &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(root o, <span class="keyword">int</span> k, root&amp; left, root&amp; right)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">splay</span>(o, k);</span><br><span class="line">    left = o;</span><br><span class="line">    right = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = node:: null;</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">200000</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;lson = node:: null;</span><br><span class="line">    nodetop-&gt;rson = node:: null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(root&amp; rt, <span class="keyword">int</span> pos, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    root left, right;</span><br><span class="line">    <span class="built_in">split</span>(rt, pos+<span class="number">1</span>, left, right);</span><br><span class="line">    left-&gt;rson = <span class="built_in">newnode</span>(key);</span><br><span class="line">    left-&gt;rson-&gt;rson = right;</span><br><span class="line">    left-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt = left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( s &gt; <span class="number">9</span> ) <span class="built_in">print</span>(s/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(s%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">node* node:: null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line">root rt;</span><br><span class="line"><span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    node:: null-&gt;key = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    node:: null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">printtree</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == node:: null ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">printtree</span>(o-&gt;lson);</span><br><span class="line">    <span class="built_in">print</span>(o-&gt;key); <span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="built_in">printtree</span>(o-&gt;rson);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N) == <span class="number">1</span> ) &#123;</span><br><span class="line">        nodetop = nodepool;</span><br><span class="line">        rt = <span class="built_in">newnode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> arg1 = <span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">int</span> arg2 = <span class="built_in">read</span>();</span><br><span class="line">            <span class="built_in">insert</span>(rt, arg1, arg2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">splay</span>(rt, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">printtree</span>(rt-&gt;rson);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
法二：离线做。类似约瑟夫问题的线段树写法。初始时，维护一个前缀和 $\displaystyle sum(N)=\sum\_{i=1}^N i$；最后一个人的最终位置显然是 pos+1，然后去掉这个人，那么倒数第二个人就成了最后一个人了。
<span id="POJ-2828_2">
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  lc (o&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  rc (o&lt;&lt;1|1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  lson lc, lft, mid</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  rson rc, mid+1, rht</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  MID(lft, rht) (lft+rht&gt;&gt;1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXN = <span class="number">200000</span>+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sumv[MAXN&lt;&lt;<span class="number">2</span>], ans[MAXN], pos[MAXN], val[MAXN], N;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht)</span> </span>&#123;</span><br><span class="line">    sumv[o] = rht-lft+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( lft == rht ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = <span class="built_in">MID</span>(lft, rht);</span><br><span class="line">    <span class="built_in">build</span>(lson);</span><br><span class="line">    <span class="built_in">build</span>(rson);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> o, <span class="keyword">int</span> lft, <span class="keyword">int</span> rht, <span class="keyword">int</span> pos, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    --sumv[o];</span><br><span class="line">    <span class="keyword">if</span>( lft == rht ) ans[lft] = val;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = <span class="built_in">MID</span>(lft, rht);</span><br><span class="line">        <span class="keyword">if</span>( pos &lt;= sumv[lc] ) <span class="built_in">query</span>(lson, pos, val);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">query</span>(rson, pos-sumv[lc], val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( s &gt; <span class="number">9</span> ) <span class="built_in">print</span>(s/<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(s%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>( <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;N) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span>, <span class="number">1</span>, N);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) </span><br><span class="line">            pos[i] = <span class="built_in">read</span>()+<span class="number">1</span>, val[i] = <span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=N; i; --i) </span><br><span class="line">            <span class="built_in">query</span>(<span class="number">1</span>, <span class="number">1</span>, N, pos[i], val[i]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) </span><br><span class="line">            <span class="built_in">print</span>(ans[i]), <span class="built_in">putchar</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<strong> update time: 2016/07/07 </strong>

<hr>
<p><strong>HYSBZ/1503 <em><a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1503">郁闷的出纳员</a></em></strong><br>只需要用 splay 实现名次树即可。注意由于存在懒惰标记，在查询第 $k$ 大，及确定有多少个值比 $key$ 小，这两个操作的过程中都要一路 $pushdown$。坑点：立即离开公司的人不算入答案。。。<br><span id="HYSBZ-1503"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span><span class="comment">/*&#123;&#123;&#123;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> siz;</span><br><span class="line">    <span class="keyword">int</span> addv;</span><br><span class="line">    node* lson;</span><br><span class="line">    node* rson;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> node* null;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">cmp</span><span class="params">(<span class="keyword">int</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt = lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( s == cnt ) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> s &lt; cnt? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        key += v;</span><br><span class="line">        addv += v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( !addv ) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>( lson != null ) lson-&gt;<span class="built_in">update</span>(addv);</span><br><span class="line">        <span class="keyword">if</span>( rson != null ) rson-&gt;<span class="built_in">update</span>(addv);</span><br><span class="line">        addv = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">maintain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        siz = lson-&gt;siz + <span class="number">1</span> + rson-&gt;siz;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> node* root;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zag</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;rson;</span><br><span class="line">    o-&gt;rson = k-&gt;lson;</span><br><span class="line">    k-&gt;lson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">zig</span><span class="params">(root&amp; o)</span> </span>&#123;</span><br><span class="line">    root k = o-&gt;lson;</span><br><span class="line">    o-&gt;lson = k-&gt;rson;</span><br><span class="line">    k-&gt;rson = o;</span><br><span class="line">    o = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(root&amp; o, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">    d? <span class="built_in">zig</span>(o): <span class="built_in">zag</span>(o);</span><br><span class="line">    d? o-&gt;rson-&gt;<span class="built_in">maintain</span>(): o-&gt;lson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    o-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">printtree</span><span class="params">(root o, <span class="keyword">int</span> cur=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == node:: null ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">printtree</span>(o-&gt;lson, cur+<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;cur %d: key=%d, siz=%d\n&quot;</span>, cur, o-&gt;key, o-&gt;siz);</span><br><span class="line">    <span class="built_in">printtree</span>(o-&gt;rson, cur+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>( !cur ) <span class="built_in">printf</span>(<span class="string">&quot;---------------------------------\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(root&amp; o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">1</span> ) k -= o-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>( d != <span class="number">-1</span> ) &#123;</span><br><span class="line">        root&amp; p = d? o-&gt;rson: o-&gt;lson;</span><br><span class="line">        p-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">        <span class="keyword">int</span> d2 = p-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">        <span class="keyword">if</span>( d2 == <span class="number">1</span> ) k -= p-&gt;lson-&gt;siz+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>( d2 != <span class="number">-1</span> ) &#123;</span><br><span class="line">            <span class="built_in">splay</span>((d2? p-&gt;rson: p-&gt;lson), k);</span><br><span class="line">            <span class="keyword">if</span>( d == d2 ) <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">rotate</span>(p, d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">rotate</span>(o, d^<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">kth</span><span class="params">(root o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">int</span> d = o-&gt;<span class="built_in">cmp</span>(k);</span><br><span class="line">    <span class="keyword">if</span>( d == <span class="number">-1</span> ) <span class="keyword">return</span> o-&gt;key;</span><br><span class="line">    <span class="keyword">return</span> d? <span class="built_in">kth</span>(o-&gt;rson, k - o-&gt;lson-&gt;siz - <span class="number">1</span>): <span class="built_in">kth</span>(o-&gt;lson, k);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">rank</span><span class="params">(root o, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( o == node:: null ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    o-&gt;<span class="built_in">pushdown</span>();</span><br><span class="line">    <span class="keyword">if</span>( k &lt;= o-&gt;key ) <span class="keyword">return</span> <span class="built_in">rank</span>(o-&gt;lson, k);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">rank</span>(o-&gt;rson, k) + o-&gt;lson-&gt;siz + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAX_NODES = <span class="number">100000</span>+<span class="number">10</span>;</span><br><span class="line">node* nodetop;</span><br><span class="line">node nodepool[MAX_NODES];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> root <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> key=<span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">    nodetop-&gt;key = key;</span><br><span class="line">    nodetop-&gt;siz = <span class="number">1</span>;</span><br><span class="line">    nodetop-&gt;addv = <span class="number">0</span>;</span><br><span class="line">    nodetop-&gt;lson = node:: null;</span><br><span class="line">    nodetop-&gt;rson = node:: null;</span><br><span class="line">    <span class="keyword">return</span> nodetop++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(root&amp; rt, <span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="built_in">rank</span>(rt, key);</span><br><span class="line">    <span class="built_in">splay</span>(rt, k);</span><br><span class="line">    root left = rt;</span><br><span class="line">    root middle = <span class="built_in">newnode</span>(key);</span><br><span class="line">    root right = rt-&gt;rson;</span><br><span class="line">    left-&gt;rson = middle;</span><br><span class="line">    middle-&gt;rson = right;</span><br><span class="line">    middle-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    left-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt = left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(root&amp; rt, <span class="keyword">int</span> M)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="built_in">rank</span>(rt, M);</span><br><span class="line">    <span class="keyword">if</span>( k == <span class="number">1</span> ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">splay</span>(rt, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, k);</span><br><span class="line">    rt-&gt;rson-&gt;lson = node:: null;</span><br><span class="line">    rt-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(root&amp; rt, <span class="keyword">int</span> addv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( rt-&gt;siz == <span class="number">2</span> ) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">splay</span>(rt, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">splay</span>(rt-&gt;rson, rt-&gt;rson-&gt;siz);</span><br><span class="line">    rt-&gt;rson-&gt;lson-&gt;<span class="built_in">update</span>(addv);</span><br><span class="line">    rt-&gt;rson-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">root rt;</span><br><span class="line"></span><br><span class="line">node* node:: null = <span class="keyword">new</span> <span class="built_in">node</span>();</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    node:: null-&gt;key = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;siz = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;addv = <span class="number">0</span>;</span><br><span class="line">    node:: null-&gt;lson = <span class="literal">NULL</span>;</span><br><span class="line">    node:: null-&gt;rson = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    nodetop = nodepool;</span><br><span class="line">    rt = <span class="built_in">newnode</span>(-INF);</span><br><span class="line">    rt-&gt;rson = <span class="built_in">newnode</span>(INF);</span><br><span class="line">    rt-&gt;<span class="built_in">maintain</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> positive = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span>( c == <span class="string">&#x27;-&#x27;</span> ) positive = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(; c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>; c=<span class="built_in">getchar</span>())</span><br><span class="line">        s = s*<span class="number">10</span> + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> positive? s: -s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">init</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> N = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">int</span> M = <span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i &lt;= N; ++i) &#123;</span><br><span class="line">        <span class="keyword">char</span> cmd[<span class="number">20</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cmd);</span><br><span class="line">        <span class="keyword">int</span> arg = <span class="built_in">read</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span>( cmd[<span class="number">0</span>] ) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;I&#x27;</span>: <span class="keyword">if</span>( arg &gt;= M ) <span class="built_in">insert</span>(rt, arg), ++tot; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>: <span class="built_in">update</span>(rt, arg); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;S&#x27;</span>: <span class="built_in">update</span>(rt, -arg); <span class="built_in">remove</span>(rt, M); <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;F&#x27;</span>: <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, arg &lt;= rt-&gt;siz<span class="number">-2</span>? <span class="built_in">kth</span>(rt, rt-&gt;siz - arg): <span class="number">-1</span>); <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, tot - rt-&gt;siz);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;<span class="comment">/*&#125;&#125;&#125;*/</span></span><br></pre></td></tr></table></figure>
</span>
<strong> update time: 2016/07/07 </strong>

<h1 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h1><table>
<thead>
<tr>
<th align="center">problems</th>
<th align="center">categories</th>
<th align="center">solution</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=3073">UVa/11922</a></strong></em></td>
<td align="center">基础题</td>
<td align="center"><em><strong><a href="#UVa-11922">Code</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="https://uva.onlinejudge.org/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=3147">UVa/11996</a></strong></em></td>
<td align="center">初级题</td>
<td align="center"><em><strong><a href="#UVa-11996">Code</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="http://hihocoder.com/problemset/problem/1329">hihoCoder/1329</a></strong></em></td>
<td align="center">基础题</td>
<td align="center"><em><strong><a href="#hihoCoder-1329">Code</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="http://hihocoder.com/problemset/problem/1333">hihoCoder/1333</a></strong></em></td>
<td align="center">初级题</td>
<td align="center"><em><strong><a href="#hihoCoder-1333">Code</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="https://icpcarchive.ecs.baylor.edu/index.php?option=com_onlinejudge&Itemid=8&page=show_problem&problem=1962">LA/3961</a></strong></em></td>
<td align="center">初级题</td>
<td align="center"><em><strong><a href="#LA-3961_1">Code1</a><em><strong>、</strong></em><a href="#LA-3961_2">Code2</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1269">HYSBZ/1269</a></strong></em></td>
<td align="center">经典题</td>
<td align="center"><em><strong><a href="#HYSBZ-1269">Code</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1500">HYSBZ/1500</a></strong></em></td>
<td align="center">经典题</td>
<td align="center"><em><strong><a href="#HYSBZ-1500">Code</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="http://poj.org/problem?id=2828">POJ/2828</a></strong></em></td>
<td align="center">基础题</td>
<td align="center">***<a href="#POJ-2828_1">Code1</a>***、 <em><strong><a href="#POJ-2828_2">Code2</a></strong></em></td>
</tr>
<tr>
<td align="center"><em><strong><a target="_blank" rel="noopener" href="http://www.lydsy.com/JudgeOnline/problem.php?id=1503">HYSBZ/1503</a></strong></em></td>
<td align="center">初级题</td>
<td align="center"><em><strong><a href="#HYSBZ-1503">Code</a></strong></em></td>
</tr>
</tbody></table>
</div></div><nav id="article-nav"><a class="article-nav-link-wrap" id="article-nav-newer" href="/study/codding/graph-theory/bipartite-graph/bipartite-graph/"><strong class="article-nav-caption"></strong><div class="article-nav-title">二分图</div></a><a class="article-nav-link-wrap" id="article-nav-older" href="/acm/oj/ccf/2015/09/5/"><div class="article-nav-title">最佳文章</div><strong class="article-nav-caption">></strong></a></nav></article><div id="gitalk-container"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"/><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
  ...JSON.parse('{"clientID":"be8f64bb869585cb410e","clientSecret":"8c4cb258aecb72ccc1af7aa76380104cace8f816","repo":"LittleClown.github.io","owner":"littleclown","admin":["littleclown","lemon-clown"],"id":"window.location.pathname","distractionFreeMode":false}'),
})

gitalk.render('gitalk-container')</script></div></div><footer id="footer"><div class="outer"><div id="footer-info"><div class="footer-left">&copy; 2021-06-13 笑着哭的小丑</div><div class="footer-right">青春是低吟浅唱、你是我学不会的歌、</div></div></div></footer></div>
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
<script>var yiliaConfig = {
  fancybox:     true,
  mathjax:      true,
  animate:      true,
  isHome:       false,
  isPost:       true,
  isArchive:    false,
  isTag:        false,
  isCategory:   false,
  open_in_new:  false,
}
</script><!-- by SparklingWind-->
<script src="/js/clipboard.min.js"></script>

<script src="/js/require.js"></script>
<script src="/js/jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>
<div id="totop"><img src="/img/scrollup.png" title="返回顶部"></div><div id="goback"><img src="/img/goback.png" title="返回上一位置"></div><!-- by SparklingWind--><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  showMathMenu: false,
  skipStartupTypeset: true,
  showProcessingMessage: false,
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  TeX: {
    equationNumbers: {
      autoNumber: 'AMS',
    },
  },
  messageStyle: 'none',
  SVG: {
    blacker: 1
  },
  styles: {
    '.MathJax_Display': {
      'user-select': 'none',
    },
  },
});

MathJax.Hub.Queue(['Typeset', MathJax.Hub, document.body])</script><!-- by SparklingWind--><script>var cnzz_protocol = ("https:" == document.location.protocol? " https://" : " http://");
document.write(unescape("%3Cspan id='cnzz_stat_icon_1259020930'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1259020930' type='text/javascript'%3E%3C/script%3E"))</script><!-- by SparklingWind--></div></body></html>